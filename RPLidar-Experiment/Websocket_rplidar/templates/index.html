</html>
<!doctype html>
<html lang="en">
<head>
    <title>lidar websocket experiment</title>
</head>
<body>
    <canvas id="graph" width="700" height="700"></canvas>
</body>
<script src="https://cdn.socket.io/3.1.3/socket.io.min.js" integrity="sha384-cPwlPLvBTa3sKAgddT6krw0cJat7egBga3DJepJyrLl4Q9/5WLra3rrnMcyTyOnh" crossorigin="anonymous"></script>
<script>
//SETUP
//websocket
var socket = io();
//distanceDiv
var distanceDiv = document.getElementById('distanceDiv');
const SCREEN_WIDTH = 700;
const SCREEN_HEIGHT = 700;
const MIN_DISTANCE = 0;
const MAX_DISTANCE = 6000;
var graph = document.getElementById('graph');
var ctx = graph.getContext("2d");

//LISTENERS
socket.on('connect', function(){
    console.log('connected');
    socket.emit('needLidar');
});
socket.on('disconnect', function(){
    console.log('disconnected');
});
socket.on('scanData', function(data) {
    ctx.clearRect(0, 0, graph.width, graph.height);
    for (let i=0;i<360;i++) {
        radians = i * (Math.PI / 180);
        distance = data[i];
        x = distance * Math.cos(radians);
        y = distance * Math.sin(radians);
        scaled_x = (SCREEN_WIDTH / 2) + (x * SCREEN_WIDTH / MAX_DISTANCE);
        scaled_y = (SCREEN_HEIGHT / 2) + (y * SCREEN_HEIGHT / MAX_DISTANCE);
        ctx.fillRect(scaled_x, scaled_y, 1, 1);
    }
});
</script>
</html>